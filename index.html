<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sudoku Master</title>
    <link
      rel="apple-touch-icon"
      sizes="57x57"
      href="/sudoku-master/apple-icon-57x57.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="60x60"
      href="/sudoku-master/apple-icon-60x60.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="72x72"
      href="/sudoku-master/apple-icon-72x72.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="76x76"
      href="/sudoku-master/apple-icon-76x76.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="114x114"
      href="/sudoku-master/apple-icon-114x114.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="120x120"
      href="/sudoku-master/apple-icon-120x120.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="144x144"
      href="/sudoku-master/apple-icon-144x144.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="152x152"
      href="/sudoku-master/apple-icon-152x152.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/sudoku-master/apple-icon-180x180.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="/sudoku-master/android-icon-192x192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/sudoku-master/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="96x96"
      href="/sudoku-master/favicon-96x96.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/sudoku-master/favicon-16x16.png"
    />
    <link rel="manifest" href="/sudoku-master/manifest.json" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta
      name="msapplication-TileImage"
      content="/sudoku-master/ms-icon-144x144.png"
    />
    <meta name="theme-color" content="#ffffff" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
  </head>
  <style>
    html,
    body {
      height: 100%;
      overflow: hidden;
      background-color: lightyellow;
    }

    p {
      text-align: center;
      color: tomato;
    }

    table,
    tr,
    td {
      border: 1px solid #d3d3d3;
      border-collapse: collapse;
    }

    table {
      margin: auto;
      border: 1px solid #000000;
    }

    input {
      width: 40px;
      height: 40px;
      background-color: transparent;
      border: none;
      text-align: center;
      font-size: 24px;
      color: inherit;
    }

    td:first-of-type {
      border-left: 1px solid #000000;
    }
    td:nth-of-type(3),
    td:nth-of-type(6),
    td:nth-of-type(9) {
      border-right: 1px solid #000000;
    }
    tr:first-of-type td {
      border-top: 1px solid #000000;
    }
    tr:last-of-type td,
    tr:nth-of-type(3) td,
    tr:nth-of-type(6) td {
      border-bottom: 1px solid #000000;
    }

    #btn-div {
      margin-top: 20px;
      text-align: center;
    }

    button {
      width: 80px;
      height: 40px;
      border: none;
      border-radius: 5px;
      background-color: #ff5454;
      color: #ffffffea;
      font-size: 18px;
      cursor: pointer;
      outline: none;
    }

    #btn-solve {
      background-color: #12f557;
    }

    .highlighted {
      background-color: #000000;
      color: #ffffff;
    }
  </style>
  <body>
    <h1 style="text-align: center;">
      Sudoku Master
    </h1>
    <p>
      Please enter your sudoku puzzle in the below grid and hit Solve button.
    </p>
    <hr/ >

    <div class="wrapper">
      <table>
        <tbody>
          <tr>
            <td>
              <input id="cell00" type="text" />
            </td>
            <td>
              <input id="cell01" type="text" />
            </td>
            <td>
              <input id="cell02" type="text" />
            </td>
            <td>
              <input id="cell03" type="text" />
            </td>
            <td>
              <input id="cell04" type="text" />
            </td>
            <td>
              <input id="cell05" type="text" />
            </td>
            <td>
              <input id="cell06" type="text" />
            </td>
            <td>
              <input id="cell07" type="text" />
            </td>
            <td>
              <input id="cell08" type="text" />
            </td>
          </tr>
          <tr>
            <td>
              <input id="cell10" type="text" />
            </td>
            <td>
              <input id="cell11" type="text" />
            </td>
            <td>
              <input id="cell12" type="text" />
            </td>
            <td>
              <input id="cell13" type="text" />
            </td>
            <td>
              <input id="cell14" type="text" />
            </td>
            <td>
              <input id="cell15" type="text" />
            </td>
            <td>
              <input id="cell16" type="text" />
            </td>
            <td>
              <input id="cell17" type="text" />
            </td>
            <td>
              <input id="cell18" type="text" />
            </td>
          </tr>
          <tr>
            <td>
              <input id="cell20" type="text" />
            </td>
            <td>
              <input id="cell21" type="text" />
            </td>
            <td>
              <input id="cell22" type="text" />
            </td>
            <td>
              <input id="cell23" type="text" />
            </td>
            <td>
              <input id="cell24" type="text" />
            </td>
            <td>
              <input id="cell25" type="text" />
            </td>
            <td>
              <input id="cell26" type="text" />
            </td>
            <td>
              <input id="cell27" type="text" />
            </td>
            <td>
              <input id="cell28" type="text" />
            </td>
          </tr>
          <tr>
            <td>
              <input id="cell30" type="text" />
            </td>
            <td>
              <input id="cell31" type="text" />
            </td>
            <td>
              <input id="cell32" type="text" />
            </td>
            <td>
              <input id="cell33" type="text" />
            </td>
            <td>
              <input id="cell34" type="text" />
            </td>
            <td>
              <input id="cell35" type="text" />
            </td>
            <td>
              <input id="cell36" type="text" />
            </td>
            <td>
              <input id="cell37" type="text" />
            </td>
            <td>
              <input id="cell38" type="text" />
            </td>
          </tr>
          <tr>
            <td>
              <input id="cell40" type="text" />
            </td>
            <td>
              <input id="cell41" type="text" />
            </td>
            <td>
              <input id="cell42" type="text" />
            </td>
            <td>
              <input id="cell43" type="text" />
            </td>
            <td>
              <input id="cell44" type="text" />
            </td>
            <td>
              <input id="cell45" type="text" />
            </td>
            <td>
              <input id="cell46" type="text" />
            </td>
            <td>
              <input id="cell47" type="text" />
            </td>
            <td>
              <input id="cell48" type="text" />
            </td>
          </tr>
          <tr>
            <td>
              <input id="cell50" type="text" />
            </td>
            <td>
              <input id="cell51" type="text" />
            </td>
            <td>
              <input id="cell52" type="text" />
            </td>
            <td>
              <input id="cell53" type="text" />
            </td>
            <td>
              <input id="cell54" type="text" />
            </td>
            <td>
              <input id="cell55" type="text" />
            </td>
            <td>
              <input id="cell56" type="text" />
            </td>
            <td>
              <input id="cell57" type="text" />
            </td>
            <td>
              <input id="cell58" type="text" />
            </td>
          </tr>
          <tr>
            <td>
              <input id="cell60" type="text" />
            </td>
            <td>
              <input id="cell61" type="text" />
            </td>
            <td>
              <input id="cell62" type="text" />
            </td>
            <td>
              <input id="cell63" type="text" />
            </td>
            <td>
              <input id="cell64" type="text" />
            </td>
            <td>
              <input id="cell65" type="text" />
            </td>
            <td>
              <input id="cell66" type="text" />
            </td>
            <td>
              <input id="cell67" type="text" />
            </td>
            <td>
              <input id="cell68" type="text" />
            </td>
          </tr>
          <tr>
            <td>
              <input id="cell70" type="text" />
            </td>
            <td>
              <input id="cell71" type="text" />
            </td>
            <td>
              <input id="cell72" type="text" />
            </td>
            <td>
              <input id="cell73" type="text" />
            </td>
            <td>
              <input id="cell74" type="text" />
            </td>
            <td>
              <input id="cell75" type="text" />
            </td>
            <td>
              <input id="cell76" type="text" />
            </td>
            <td>
              <input id="cell77" type="text" />
            </td>
            <td>
              <input id="cell78" type="text" />
            </td>
          </tr>
          <tr>
            <td>
              <input id="cell80" type="text" />
            </td>
            <td>
              <input id="cell81" type="text" />
            </td>
            <td>
              <input id="cell82" type="text" />
            </td>
            <td>
              <input id="cell83" type="text" />
            </td>
            <td>
              <input id="cell84" type="text" />
            </td>
            <td>
              <input id="cell85" type="text" />
            </td>
            <td>
              <input id="cell86" type="text" />
            </td>
            <td>
              <input id="cell87" type="text" />
            </td>
            <td>
              <input id="cell88" type="text" />
            </td>
          </tr>
        </tbody>
      </table>
      <div id="btn-div">
        <button id="btn-solve">Solve</button>
        <button id="btn-reset">Reset</button>
      </div>
    </div>
  </body>

  <script>
    // onclick listener on solve button
    document
      .getElementById('btn-solve')
      .addEventListener('click', onClickSolve);

    // onclick listener on reset button
    document
      .getElementById('btn-reset')
      .addEventListener('click', onClickReset);

    // add onKeyUp listener to all input fields
    // and check of valid number input only
    for (let i = 0; i < 9; i++) {
      for (let j = 0; j < 9; j++) {
        let cellId = 'cell' + i + j;
        document
          .getElementById(cellId)
          .addEventListener('keyup', onChangeInput);
      }
    }

    // check if all numbers in the array are unique or zero
    function isUniq(arr) {
      let copyArr = [...arr];
      copyArr.sort();
      for (let i = 1; i < copyArr.length; i++) {
        if (copyArr[i] !== 0 && copyArr[i] === copyArr[i - 1]) {
          return false;
        }
      }
      return true;
    }

    // check if the given grid has any illegal entry already
    function isGridLegal(grid) {
      // check for all rows in the grid
      for (let i = 0; i < grid.length; i++) {
        if (!isUniq(grid[i])) {
          return false;
        }
      }
      // check for all colums in the grid
      for (let i = 0; i < 9; i++) {
        let column = [];
        for (let j = 0; j < 9; j++) {
          column.push(grid[j][i]);
        }
        if (!isUniq(column)) {
          return false;
        }
      }
      // check 3x3 square wise
      for (let i = 0; i < 9; i += 3) {
        for (let j = 0; j < 9; j += 3) {
          let cells = [];
          for (let x = 0; x < 3; x++) {
            for (let y = 0; y < 3; y++) {
              cells.push(grid[x + i][y + j]);
            }
          }
          if (!isUniq(cells)) {
            return false;
          }
        }
      }

      return true;
    }

    // check a given number is legal at position x,y of given grid
    function isPossible(x, y, n, grid) {
      // if the cell is not empty at x, y position then we return false
      if (grid[x][y] !== 0) {
        return false;
      }

      // check if n exists in the row already
      for (let i = 0; i < 9; i++) {
        if (grid[x][i] === n) {
          return false;
        }
      }

      // check if n exists in the column
      for (let i = 0; i < 9; i++) {
        if (grid[i][y] === n) {
          return false;
        }
      }

      // check if n exists in the small 3 x 3 square
      // row wise lower bound
      let rlb = Math.floor(x / 3) * 3;
      let clb = Math.floor(y / 3) * 3;
      for (let i = 0; i < 3; i++) {
        for (let j = 0; j < 3; j++) {
          if (grid[rlb + i][clb + j] === n) {
            return false;
          }
        }
      }

      // return true if all 3 validation passed
      return true;
    }

    // solves the given grid recursively and returns the solved grid
    function solveGrid(grid) {
      for (let i = 0; i < 9; i++) {
        for (let j = 0; j < 9; j++) {
          // check if grid is empty at i, j position
          if (grid[i][j] === 0) {
            let max = 9;
            let min = 1;
            let s = Math.floor(Math.random() * (max - min + 1)) + min;
            for (let k = 0; k < 9; k++) {
              let c = ((k + s) % 9) + 1;
              if (isPossible(i, j, c, grid)) {
                grid[i][j] = c;
                let newGrid = solveGrid(grid);
                // if current choice of value k is incorrect
                // then subsequent solveGrid function call
                // will return false, in that case we nullify
                // the current choice and look for other solution
                if (newGrid) {
                  return newGrid;
                }
                grid[i][j] = 0;
              }
            }

            // when no number is possible then return false
            // so that previous choice can be nullified
            return false;
          }
        }
      }

      // if no position in the grid is empty then return the grid
      return grid;
    }

    // onchange callback of the input fields
    // checks for the valid number input only
    function onChangeInput(event) {
      event.preventDefault();
      let value = event.target.value;
      if (isNaN(value) || parseInt(value, 10) > 9 || parseInt(value, 10) < 1) {
        event.target.value = '';
      } else {
        let indexes = event.target.id.replace('cell', '').split('');
        if (indexes.length < 2) {
          return;
        }
        let i = parseInt(indexes[0]);
        let j = parseInt(indexes[1]);
        if (j < 8) {
          j++;
        } else {
          if (i < 8) {
            i++;
            j = 0;
          } else {
            i = 0;
            j = 0;
          }
        }
        let cellId = 'cell' + i + j;
        document.getElementById(cellId).focus();
      }
    }

    // onclick listener of the Solve button
    // solves the grid
    function onClickSolve() {
      let grid = [];
      for (let i = 0; i < 9; i++) {
        let row = [];
        for (let j = 0; j < 9; j++) {
          let cellId = 'cell' + i + j;
          let value = document.getElementById(cellId).value || '0';
          row.push(parseInt(value, 10));
        }
        grid.push(row);
      }

      //   check if the grid has any illegal entry already
      if (!isGridLegal(grid)) {
        if (Swal) {
          Swal.fire({
            title: 'Error!',
            text: 'The grid contains illegal input. Please correct all inputs.',
            icon: 'error',
          });
        } else {
          alert('Illegal grid!');
        }
        return;
      }

      let solvedGrid = solveGrid(grid);
      if (!solvedGrid) {
        if (Swal) {
          Swal.fire({
            title: 'Error!',
            text:
              'Unable to find any solution. Please correct all inputs and try again.',
            icon: 'error',
          });
        } else {
          alert(
            'Unable to find any solution. Please correct all inputs and try again.'
          );
        }
        return;
      }

      for (let i = 0; i < 9; i++) {
        for (let j = 0; j < 9; j++) {
          let cellId = 'cell' + i + j;
          document.getElementById(cellId).value = solvedGrid[i][j];
        }
      }
    }

    // onClick callback of reset button
    // clear out the whole grid
    function onClickReset() {
      for (let i = 0; i < 9; i++) {
        for (let j = 0; j < 9; j++) {
          let cellId = 'cell' + i + j;
          document.getElementById(cellId).value = '';
        }
      }
    }

    // register the service worker
    if ('serviceWorker' in navigator) {
      console.log('CLIENT: service worker registration in progress.');
      navigator.serviceWorker.register('/sudoku-master/service-worker.js').then(
        function () {
          console.log('CLIENT: service worker registration complete.');
        },
        function () {
          console.log('CLIENT: service worker registration failure.');
        }
      );
    } else {
      console.log('CLIENT: service worker is not supported.');
    }
  </script>
</html>
